-- ✅ Lumix Hub | Fluent UI + PandaAuth V3 (Class-A)
-- • Uses Fluent UI (not WindUI)
-- • Panda V3 auth (service=lumixhub, security=3)
-- • 3 retries per session
-- • Status tab live updates
-- • EMBEDDED 99 Nights (AXS-2) runs after key validation in a separate thread
-- • Auto-closes loader on success
-- • Themes tab (Dark/Light/Acrylic)
-- • No Pelinda loadstring here (Panda injects Pelinda at runtime in Panda build)

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

-- ──────────────────────────────────────────────────────────────────────────────
-- Window
local Window = Fluent:CreateWindow({
    Title = "Lumix Hub | Key System",
    SubTitle = "PandaAuth V3 • Fluent UI",
    TabWidth = 160,
    Size = UDim2.fromOffset(520, 320),
    Acrylic = true,
    Theme = "Dark",
})

-- Tabs
local AuthTab   = Window:AddTab({ Title = "🔐 Authentication", Icon = "rbxassetid://4483345998" })
local ThemesTab = Window:AddTab({ Title = "🎨 Themes",          Icon = "rbxassetid://4483345998" })
local StatusTab = Window:AddTab({ Title = "🟡 Status",           Icon = "rbxassetid://7734053429" })

-- Status paragraph (resets each session)
local statusPara = StatusTab:AddParagraph({
    Title = "System Status",
    Content = "🟡 Waiting for validation..."
})

local function setStatus(text)
    if statusPara and statusPara.Set then
        statusPara:Set({ Title = "System Status", Content = text })
    elseif statusPara and statusPara.SetDesc then
        statusPara:SetDesc(text)
    else
        StatusTab:AddParagraph({ Title = "System Status", Content = text })
    end
end

-- Retry tracking
local maxAttempts = 3
local attemptsLeft = maxAttempts

-- Key input
local userKey = ""
AuthTab:AddInput("EnterKey", {
    Title = "Enter Key",
    Default = "",
    Placeholder = "Paste your key here...",
    Callback = function(value)
        userKey = value or ""
    end
})

-- Helpers
local function safeNotify(title, content, duration)
    pcall(function()
        Fluent:Notify({ Title = title, Content = content, Duration = duration or 3 })
    end)
end

-- Submit button
AuthTab:AddButton({
    Title = "Submit Key",
    Description = "Validate your Lumix Hub key via PandaAuth V3",
    Callback = function()
        -- Guard: Pelinda must exist (injected by Panda in obfuscated build)
        if not Pelinda then
            setStatus("⚠️ Panda runtime not detected. Run the Panda-built file.")
            safeNotify("PandaV3", "⚠️ Panda runtime not detected.", 4)
            return
        end

        if userKey == "" then
            safeNotify("PandaV3", "⚠️ Please enter a key before submitting!", 3)
            return
        end

        local ok, status = pcall(function()
            return Pelinda.Init({
                Service = "lumixhub",
                SilentMode = true,
                Key = userKey,
                SecurityLevel = 3,
            })
        end)

        if ok and status == "validated!!" then
            setStatus("🟢 Key validated, launching script...")
            safeNotify("PandaV3", "✅ Lumix Hub Loaded Successfully!", 3)

            -- Small defer so Panda can finish internal work before we run heavy code
            task.delay(0.05, function()
                -- ✅ Run 99 Nights in a separate thread so Roblox doesn’t freeze
                task.spawn(function()
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
